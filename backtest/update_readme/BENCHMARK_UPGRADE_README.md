# BenchmarkManager å‡çº§è¯´æ˜

## ğŸ“‹ æ”¹åŠ¨æ¦‚è§ˆ

æœ¬æ¬¡å‡çº§ä¸º `benchmark_manager.py` æ·»åŠ äº†æ™ºèƒ½ç¼“å­˜åŠŸèƒ½ï¼Œå¹¶å°†æŒ‡æ•°ä»£ç æ›´æ–°ä¸ºç±³ç­ï¼ˆRQDataï¼‰æ ‡å‡†æ ¼å¼ã€‚

## ğŸ¯ ä¸»è¦æ”¹è¿›

### 1. æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ

#### âœ… å·²å®ç°çš„åŠŸèƒ½

- **è‡ªåŠ¨ç¼“å­˜**: ä»ç±³ç­APIè·å–çš„æ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°
- **èŒƒå›´æ£€æŸ¥**: è¯·æ±‚æ•°æ®å‰æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¦†ç›–æ‰€éœ€èŒƒå›´
- **å¢é‡æ›´æ–°**: åªä¸‹è½½ç¼ºå¤±çš„æ•°æ®éƒ¨åˆ†ï¼Œä¸ç°æœ‰ç¼“å­˜åˆå¹¶
- **å…ƒæ•°æ®ç®¡ç†**: æ¯ä¸ªç¼“å­˜åŒ…å«å…ƒæ•°æ®æ–‡ä»¶ï¼Œè®°å½•æ—¥æœŸèŒƒå›´å’Œæ›´æ–°æ—¶é—´

#### ğŸ“Š ç¼“å­˜ç­–ç•¥

1. **é¦–æ¬¡è·å–**: ä»APIä¸‹è½½ â†’ ä¿å­˜åˆ°ç¼“å­˜
2. **å†æ¬¡è·å–ç›¸åŒèŒƒå›´**: ä»ç¼“å­˜åŠ è½½ â†’ æ— éœ€APIè°ƒç”¨
3. **æ‰©å±•æ—¥æœŸèŒƒå›´**: å¢é‡ä¸‹è½½ â†’ ä¸ç¼“å­˜åˆå¹¶ â†’ ä¿å­˜æ›´å¤§èŒƒå›´
4. **è·å–å­èŒƒå›´**: ä»ç¼“å­˜ç­›é€‰ â†’ æ— éœ€APIè°ƒç”¨

### 2. æŒ‡æ•°ä»£ç æ›´æ–°

å°†æ‰€æœ‰æŒ‡æ•°ä»£ç ä»æ—§æ ¼å¼æ›´æ–°ä¸ºç±³ç­æ ‡å‡†æ ¼å¼ï¼š

| æŒ‡æ•° | æ—§ä»£ç  | æ–°ä»£ç  (ç±³ç­æ ¼å¼) |
|------|--------|------------------|
| æ²ªæ·±300 | 000300.SH | 000300.XSHG |
| ä¸­è¯500 | 000905.SH | 000905.XSHG |
| ä¸­è¯800 | 000906.SH | 000906.XSHG |
| ä¸Šè¯50  | 000016.SH | 000016.XSHG |
| ä¸­è¯1000 | 000852.SH | 000852.XSHG |
| æ·±è¯æˆæŒ‡ | - | 399001.XSHE |
| åˆ›ä¸šæ¿æŒ‡ | - | 399006.XSHE |

## ğŸ“ æ–°å¢æ–‡ä»¶

```
Factorsystem/
â”œâ”€â”€ benchmark_manager.py           # â¬†ï¸ å‡çº§ç‰ˆæœ¬ï¼ˆå¸¦ç¼“å­˜ï¼‰
â”œâ”€â”€ benchmark_manager_backup.py    # ğŸ“¦ åŸå§‹ç‰ˆæœ¬å¤‡ä»½
â”œâ”€â”€ test_benchmark_cache.py        # ğŸ§ª ç¼“å­˜åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ example_benchmark_usage.py     # ğŸ“– ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ BENCHMARK_CACHE_GUIDE.md       # ğŸ“š è¯¦ç»†ä½¿ç”¨æŒ‡å—
â””â”€â”€ BENCHMARK_UPGRADE_README.md    # ğŸ“„ æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from Factorsystem.benchmark_manager import BenchmarkManager

# åˆå§‹åŒ–ç®¡ç†å™¨
manager = BenchmarkManager()

# è·å–æ²ªæ·±300æŒ‡æ•°æ”¶ç›Šç‡ï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼‰
returns = manager.get_benchmark_returns(
    'hs300',
    start_date='2023-01-01',
    end_date='2023-12-31',
    data_source='rqdatac'
)

print(f"ç´¯è®¡æ”¶ç›Šç‡: {(1 + returns).prod() - 1:.2%}")
```

### æŸ¥çœ‹ç¼“å­˜ä¿¡æ¯

```python
# æŸ¥çœ‹æ‰€æœ‰ç¼“å­˜
cache_info = manager.get_cache_info()
print(cache_info)
```

### æ¸…é™¤ç¼“å­˜

```python
# æ¸…é™¤ç‰¹å®šæŒ‡æ•°
manager.clear_cache('000300.XSHG')

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
manager.clear_cache()
```

## ğŸ”§ è¿è¡Œæµ‹è¯•

### æµ‹è¯•ç¼“å­˜åŠŸèƒ½

```bash
cd /home/u2025210237/jupyterlab/quantclassic/Factorsystem
python test_benchmark_cache.py
```

### è¿è¡Œä½¿ç”¨ç¤ºä¾‹

```bash
python example_benchmark_usage.py
```

### å†…ç½®æµ‹è¯•

```bash
python benchmark_manager.py
```

## ğŸ’¾ ç¼“å­˜å­˜å‚¨

### é»˜è®¤ä½ç½®

```
cache/benchmark/
â”œâ”€â”€ 000300_XSHG.parquet          # æ²ªæ·±300æ•°æ®
â”œâ”€â”€ 000300_XSHG_meta.json        # æ²ªæ·±300å…ƒæ•°æ®
â”œâ”€â”€ 000905_XSHG.parquet          # ä¸­è¯500æ•°æ®
â”œâ”€â”€ 000905_XSHG_meta.json        # ä¸­è¯500å…ƒæ•°æ®
â””â”€â”€ ...
```

### è‡ªå®šä¹‰ç¼“å­˜ç›®å½•

```python
manager = BenchmarkManager(cache_dir="data/my_cache")
```

## ğŸ“– ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1: å›æµ‹ä¸­ä½¿ç”¨åŸºå‡†

```python
from Factorsystem.benchmark_manager import BenchmarkManager

manager = BenchmarkManager()

# è·å–å›æµ‹æœŸé—´çš„åŸºå‡†æ”¶ç›Š
benchmark_returns = manager.get_benchmark_returns(
    'hs300',
    start_date='2020-01-01',
    end_date='2023-12-31'
)

# è®¡ç®—è¶…é¢æ”¶ç›Š
excess = manager.calculate_excess_returns(
    portfolio_returns,
    benchmark_returns
)
```

### åœºæ™¯2: å¯¹æ¯”å¤šä¸ªæŒ‡æ•°

```python
indices = ['hs300', 'zz500', 'zz800']

for idx in indices:
    returns = manager.get_benchmark_returns(
        idx,
        start_date='2023-01-01',
        end_date='2023-12-31'
    )
    print(f"{idx}: {(1 + returns).prod() - 1:.2%}")
```

### åœºæ™¯3: æ—¶é—´åºåˆ—åˆ†æ

```python
# è·å–é•¿æœŸæ•°æ®ç”¨äºåˆ†æ
returns = manager.get_benchmark_returns(
    'hs300',
    start_date='2015-01-01',
    end_date='2023-12-31'
)

# åˆ†æä¸åŒæ—¶æœŸè¡¨ç°
for year in range(2015, 2024):
    year_returns = returns[str(year)]
    print(f"{year}: {(1 + year_returns).prod() - 1:.2%}")
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### BenchmarkCache ç±»

è´Ÿè´£ç¼“å­˜çš„åº•å±‚ç®¡ç†:

- `load_cache()`: åŠ è½½ç¼“å­˜æ•°æ®
- `save_cache()`: ä¿å­˜æ•°æ®åˆ°ç¼“å­˜
- `get_cache_range()`: è·å–ç¼“å­˜çš„æ—¥æœŸèŒƒå›´
- `check_cache_coverage()`: æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¦†ç›–æ‰€éœ€èŒƒå›´
- `merge_with_cache()`: å°†æ–°æ•°æ®ä¸ç¼“å­˜åˆå¹¶

### BenchmarkManager ç±»

ä¸»è¦æ¥å£:

- `get_benchmark_returns()`: è·å–åŸºå‡†æ”¶ç›Šç‡ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
- `calculate_excess_returns()`: è®¡ç®—è¶…é¢æ”¶ç›Š
- `get_cache_info()`: æŸ¥çœ‹ç¼“å­˜ä¿¡æ¯
- `clear_cache()`: æ¸…é™¤ç¼“å­˜
- `get_universe_stocks()`: è·å–æŒ‡æ•°æˆåˆ†è‚¡

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç±³ç­è´¦å·**: é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½® rqdatac è´¦å·
2. **ç½‘ç»œè¿æ¥**: é¦–æ¬¡ä¸‹è½½æˆ–æ‰©å±•èŒƒå›´æ—¶éœ€è¦ç½‘ç»œ
3. **ç¼“å­˜æ›´æ–°**: ç¼“å­˜ä¸ä¼šè‡ªåŠ¨æ›´æ–°å†å²æ•°æ®ï¼Œå¦‚éœ€æœ€æ–°æ•°æ®è¯·æ‰©å±•æ—¥æœŸèŒƒå›´
4. **å­˜å‚¨ç©ºé—´**: æ¯ä¸ªæŒ‡æ•°ç¼“å­˜çº¦å‡ KBåˆ°å‡ MB

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

æ—§ç‰ˆæœ¬ä»£ç :
```python
returns = manager.get_benchmark_returns('hs300', '2023-01-01', '2023-12-31')
```

æ–°ç‰ˆæœ¬ï¼ˆå®Œå…¨å…¼å®¹ï¼‰:
```python
returns = manager.get_benchmark_returns('hs300', '2023-01-01', '2023-12-31')
# ç°åœ¨è‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼
```

### ç¦ç”¨ç¼“å­˜ï¼ˆä¿æŒæ—§è¡Œä¸ºï¼‰

```python
returns = manager.get_benchmark_returns(
    'hs300', 
    '2023-01-01', 
    '2023-12-31',
    use_cache=False  # ç¦ç”¨ç¼“å­˜
)
```

## ğŸ“š æ–‡æ¡£

- **è¯¦ç»†æŒ‡å—**: `BENCHMARK_CACHE_GUIDE.md` - å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£
- **ä½¿ç”¨ç¤ºä¾‹**: `example_benchmark_usage.py` - 6ä¸ªå®ç”¨ç¤ºä¾‹
- **æµ‹è¯•è„šæœ¬**: `test_benchmark_cache.py` - 5ä¸ªæµ‹è¯•ç”¨ä¾‹

## ğŸ› æ•…éšœæ’é™¤

### ç±³ç­åˆå§‹åŒ–å¤±è´¥

```python
import rqdatac as rq
rq.init()  # ç¡®ä¿ç±³ç­å·²åˆå§‹åŒ–
```

### ç¼“å­˜æŸå

```python
manager.clear_cache()  # æ¸…é™¤æ‰€æœ‰ç¼“å­˜é‡æ–°ä¸‹è½½
```

### æ—¥æœŸèŒƒå›´é—®é¢˜

ç¡®ä¿æ—¥æœŸæ ¼å¼ä¸º `YYYY-MM-DD`ï¼Œä¾‹å¦‚ `'2023-01-01'`

## ğŸ“Š æ€§èƒ½æå‡

- **é¦–æ¬¡è·å–**: ä¸åŸç‰ˆæœ¬ç›¸åŒï¼ˆéœ€è°ƒç”¨APIï¼‰
- **é‡å¤è·å–**: ~100x é€Ÿåº¦æå‡ï¼ˆä»ç¼“å­˜è¯»å–ï¼Œæ— éœ€APIï¼‰
- **èŒƒå›´æ‰©å±•**: ~2-10x é€Ÿåº¦æå‡ï¼ˆåªä¸‹è½½ç¼ºå¤±éƒ¨åˆ†ï¼‰

## âœ… æµ‹è¯•æ¸…å•

- [x] åŸºæœ¬ç¼“å­˜åŠŸèƒ½
- [x] ç¼“å­˜èŒƒå›´æ£€æŸ¥
- [x] å¢é‡æ›´æ–°
- [x] å¤šæŒ‡æ•°æ”¯æŒ
- [x] å…ƒæ•°æ®ç®¡ç†
- [x] ç¼“å­˜æ¸…é™¤
- [x] å‘åå…¼å®¹

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡å‡çº§åœ¨ä¿æŒå®Œå…¨å‘åå…¼å®¹çš„å‰æä¸‹ï¼Œä¸º BenchmarkManager æ·»åŠ äº†æ™ºèƒ½ç¼“å­˜åŠŸèƒ½ï¼Œå¤§å¹…æå‡äº†æ•°æ®è·å–æ•ˆç‡ï¼ŒåŒæ—¶å°†æŒ‡æ•°ä»£ç æ›´æ–°ä¸ºç±³ç­æ ‡å‡†æ ¼å¼ï¼Œä½¿å…¶æ›´é€‚åˆä¸ç±³ç­APIé…åˆä½¿ç”¨ã€‚

---

**å‡çº§æ—¥æœŸ**: 2024-11-24  
**ç‰ˆæœ¬**: v2.0  
**ä½œè€…**: Copilot
