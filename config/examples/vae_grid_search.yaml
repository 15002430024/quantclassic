# VAE è¶…å‚æ•°ç½‘æ ¼æœç´¢é…ç½®
# ç”¨äºæ‰¹é‡æµ‹è¯•ä¸åŒçš„ latent_dim é…ç½®

# ä½¿ç”¨æ–¹æ³•:
# for latent in 8 16 32; do
#     python -m quantclassic.config.cli vae_grid_search_latent${latent}.yaml
# done

experiment_name: vae_latent8  # æ‰‹åŠ¨ä¿®æ”¹ä¸º vae_latent16, vae_latent32

task:
  dataset:
    class: DataManager
    module_path: quantclassic.data_set.manager
    kwargs:
      config:
        base_dir: "output"
        data_file: "train_data_final_01.parquet"
        window_size: 40
        batch_size: 512
        num_workers: 4
        train_ratio: 0.6
        val_ratio: 0.2
        test_ratio: 0.2
        shuffle: true
  
  model:
    class: VAE
    module_path: quantclassic.model.pytorch_models
    kwargs:
      d_feat: 20
      hidden_dim: 128
      latent_dim: 8  # ğŸ”§ ä¿®æ”¹æ­¤å€¼: 8, 16, 32
      window_size: 40
      dropout: 0.3
      
      # VAEæŸå¤±æƒé‡
      alpha_recon: 0.1
      beta_kl: 0.001
      gamma_pred: 1.0
      
      # è®­ç»ƒå‚æ•°
      n_epochs: 50
      lr: 0.001
      batch_size: 512
      device: "cuda"
      seed: 42  # å›ºå®šéšæœºç§å­ä¿è¯å¯å¤ç°
  
  backtest:
    class: FactorBacktestSystem
    module_path: quantclassic.backtest.backtest_system
    kwargs:
      config:
        output_dir: "output/vae_latent8"  # ğŸ”§ ä¿®æ”¹è¾“å‡ºç›®å½•
        save_plots: true
        generate_excel: true
        n_groups: 10
        ic_method: "spearman"

# ========================================================================
# ç½‘æ ¼æœç´¢è„šæœ¬ç¤ºä¾‹ (Bash)
# ========================================================================
# 
# #!/bin/bash
# 
# for latent in 8 16 32; do
#     # å¤åˆ¶æ¨¡æ¿
#     cp vae_grid_search.yaml vae_latent${latent}.yaml
#     
#     # ä¿®æ”¹ latent_dim
#     sed -i "s/latent_dim: 8/latent_dim: ${latent}/g" vae_latent${latent}.yaml
#     sed -i "s/experiment_name: vae_latent8/experiment_name: vae_latent${latent}/g" vae_latent${latent}.yaml
#     sed -i "s/output_dir: \"output\/vae_latent8\"/output_dir: \"output\/vae_latent${latent}\"/g" vae_latent${latent}.yaml
#     
#     # è¿è¡Œ
#     echo "========================================="
#     echo "Running with latent_dim=${latent}"
#     echo "========================================="
#     python -m quantclassic.config.cli vae_latent${latent}.yaml
# done
# 
# # å¯¹æ¯”ç»“æœ
# echo "========================================="
# echo "Results comparison:"
# echo "========================================="
# for latent in 8 16 32; do
#     echo "Latent dim: ${latent}"
#     cat output/vae_latent${latent}/backtest_report.txt | grep "ICå‡å€¼"
#     cat output/vae_latent${latent}/backtest_report.txt | grep "å¹´åŒ–å¤æ™®"
#     echo ""
# done
# 
# ========================================================================
