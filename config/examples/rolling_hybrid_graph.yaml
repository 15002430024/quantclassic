# =============================================================================
# QuantClassic æ»šåŠ¨è®­ç»ƒ + åŠ¨æ€å›¾ é…ç½®ç¤ºä¾‹
# =============================================================================
# æ­¤é…ç½®å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ–°çš„é…ç½®ç³»ç»Ÿï¼š
# 1. ä½¿ç”¨ RollingDailyTrainer è¿›è¡Œæ»šåŠ¨çª—å£è®­ç»ƒ
# 2. é…ç½® GraphBuilder æ„å»ºåŠ¨æ€é‚»æ¥çŸ©é˜µ
# 3. ä½¿ç”¨ HybridGraphModel (RNN+Attention+GAT+MLP)
# =============================================================================

# ä»»åŠ¡é…ç½®
task:
  # ==================== æ¨¡å‹é…ç½® ====================
  model_class: "HybridGraphModel"
  model_kwargs:
    d_feat: 20                    # è¾“å…¥ç‰¹å¾ç»´åº¦
    rnn_hidden: 64                # RNN éšè—å±‚å¤§å°
    rnn_layers: 2                 # RNN å±‚æ•°
    rnn_type: "lstm"              # RNN ç±»å‹: lstm / gru
    use_attention: true           # æ˜¯å¦ä½¿ç”¨ Self-Attention
    use_graph: true               # æ˜¯å¦ä½¿ç”¨å›¾ç¥ç»ç½‘ç»œ
    gat_hidden: 32                # GAT éšè—å±‚ç»´åº¦
    gat_heads: 4                  # GAT æ³¨æ„åŠ›å¤´æ•°
    mlp_hidden_sizes: [64]        # MLP éšè—å±‚å°ºå¯¸
    dropout: 0.3                  # Dropout æ¦‚ç‡
    use_residual: true            # ğŸ†• æ˜¯å¦ä½¿ç”¨æ®‹å·®è¿æ¥
    output_dim: 1                 # è¾“å‡ºç»´åº¦ï¼ˆå•å› å­ï¼‰
    # è®­ç»ƒå‚æ•°
    n_epochs: 50
    learning_rate: 0.001
    early_stop: 10
    batch_size: 256
  
  # ==================== æ•°æ®é›†é…ç½® ====================
  dataset_class: "DataManager"
  dataset_kwargs:
    config:
      # æ•°æ®è·¯å¾„
      base_dir: "rq_data_parquet"
      data_file: "train_data_final.parquet"
      cache_dir: "cache/data_set"
      output_dir: "output"
      
      # ç‰¹å¾å·¥ç¨‹
      window_size: 40
      label_col: "y_processed"
      stock_col: "order_book_id"
      time_col: "trade_date"
      
      # æ•°æ®åˆ’åˆ† - æ»šåŠ¨çª—å£æ¨¡å¼
      split_strategy: "rolling"
      rolling_window_size: 252     # çº¦1å¹´
      rolling_step: 63             # çº¦1å­£åº¦
      
      # çª—å£çº§å˜æ¢ï¼ˆç ”æŠ¥æ ‡å‡†ï¼‰
      enable_window_transform: true
      window_price_log: true
      window_volume_norm: true
      
      # ğŸ†• å›¾æ„å»ºå™¨é…ç½® - è¿™æ˜¯å…³é”®ï¼
      graph_builder_config:
        type: "hybrid"             # æ··åˆå›¾: Î± * corr + (1-Î±) * industry
        alpha: 0.7                 # ç›¸å…³æ€§å›¾æƒé‡
        corr_method: "cosine"      # ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•: cosine / pearson / spearman
        top_k: 10                  # æ¯åªè‚¡ç¥¨ä¿ç•™çš„é‚»å±…æ•°
        industry_col: "industry_name"
        industry_adj_path: "output/industry_adj_matrix.pt"  # é¢„è®¡ç®—çš„è¡Œä¸šé‚»æ¥çŸ©é˜µ
        add_self_loop: true
        symmetric: true
      
      # æ‰¹æ¬¡é…ç½®
      batch_size: 256
      num_workers: 0
      shuffle_train: true
      
      # æ—¥å¿—
      verbose: true
      log_level: "INFO"
  
  # ==================== ğŸ†• è®­ç»ƒå™¨é…ç½® ====================
  trainer_class: "RollingDailyTrainer"
  trainer_kwargs:
    n_epochs: 20                  # æ¯ä¸ªçª—å£çš„è®­ç»ƒè½®æ•°
    learning_rate: 0.001
    early_stop: 5
    warm_start: true              # ç»§æ‰¿ä¸Šä¸€çª—å£çš„æ¨¡å‹æƒé‡
    save_each_window: true        # ä¿å­˜æ¯ä¸ªçª—å£çš„æ¨¡å‹
    save_dir: "output/rolling_models"
    # å­¦ä¹ ç‡è°ƒåº¦å™¨
    use_scheduler: true
    scheduler_type: "plateau"
    scheduler_patience: 5
    scheduler_factor: 0.5
  
  # ğŸ†• ä½¿ç”¨æ»šåŠ¨çª—å£åŠ è½½å™¨
  use_rolling_loaders: true
  use_daily_loaders: false
  
  # ==================== å›æµ‹é…ç½®ï¼ˆå¯é€‰ï¼‰====================
  backtest_enabled: false
  backtest_kwargs:
    start_date: "2023-01-01"
    end_date: "2024-12-31"
    top_k: 50
    rebalance_freq: "weekly"


# =============================================================================
# ä½¿ç”¨æ–¹å¼:
# =============================================================================
# æ–¹å¼ 1: CLI è¿è¡Œ
#   python -m quantclassic.cli run --config rolling_hybrid_graph.yaml
#
# æ–¹å¼ 2: Python ä»£ç 
#   from quantclassic.config import ConfigLoader, TaskRunner
#   
#   config = ConfigLoader.load('rolling_hybrid_graph.yaml')
#   runner = TaskRunner()
#   results = runner.run(config, experiment_name='rolling_hybrid')
#
# æ–¹å¼ 3: ä½¿ç”¨ TaskConfig å¯¹è±¡
#   from quantclassic.config.base_config import TaskConfig
#   
#   task_config = TaskConfig(
#       model_class='HybridGraphModel',
#       model_kwargs={...},
#       trainer_class='RollingDailyTrainer',
#       use_rolling_loaders=True,
#       ...
#   )
#   results = runner.run(task_config)
# =============================================================================
